<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="Bit_RPG.GamePage"
             Title="GamePage">
    
    <!-- Add safe area handling for notches/navigation bars -->
    <ContentPage.Padding>
        <OnPlatform x:TypeArguments="Thickness">
            <On Platform="iOS" Value="0,20,0,0" />
            <On Platform="Android" Value="0" />
        </OnPlatform>
    </ContentPage.Padding>
    
    <Grid RowDefinitions="Auto,*,Auto" RowSpacing="0">
        
        <!-- Player Information Panel - Responsive -->
        <Border Grid.Row="0"
                Stroke="Gray"
                StrokeThickness="1"
                Padding="12"
                Margin="10,10,10,0">
            <Grid RowDefinitions="Auto,Auto" RowSpacing="8">
                <!-- Row 1: Name, Level, Gold -->
                <HorizontalStackLayout Grid.Row="0" Spacing="15" HorizontalOptions="Start">
                    <Label FontSize="14" FontAttributes="Bold">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="{Binding Player.PlayerName}" FontAttributes="Bold"/>
                                <Span Text=" â€¢ "/>
                                <Span Text="Lvl "/>
                                <Span Text="{Binding Player.Level}" FontAttributes="Bold"/>
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                    <Label Text="{Binding Player.Money, StringFormat='ðŸ’° {0}'}"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}"/>
                </HorizontalStackLayout>
                
                <!-- Row 2: Race, Class, AP, Week/Year -->
                <HorizontalStackLayout Grid.Row="1" Spacing="12">
                    <Label Text="{Binding Player.Race}"
                           FontSize="12"
                           TextColor="Gray"/>
                    <Label Text="{Binding Player.Class}"
                           FontSize="12"
                           TextColor="Gray"/>
                    <Label FontSize="12"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}">
                        <Label.Text>
                            <MultiBinding StringFormat="âš¡ {0}/{1}">
                                <Binding Path="Player.ActionPoints"/>
                                <Binding Source="12"/>
                            </MultiBinding>
                        </Label.Text>
                    </Label>
                    <Label Text="{Binding Year, StringFormat='Y{0}'}"
                           FontSize="12"/>
                    <Label Text="{Binding Week, StringFormat='W{0}'}"
                           FontSize="12"/>
                </HorizontalStackLayout>
            </Grid>
        </Border>

        <!-- Event Log - Flexible height -->
        <Border Grid.Row="1"
                Stroke="Gray"
                StrokeThickness="1"
                Padding="12"
                Margin="10,10,10,0">
            <ScrollView x:Name="EventScrollView">
                <Label Text="{Binding EventLog}"
                       FontSize="14"
                       LineBreakMode="WordWrap"
                       LineHeight="1.3"/>
            </ScrollView>
        </Border>
        
        <!-- Bottom Navigation Bar - Touch-optimized -->
        <Grid Grid.Row="2" 
              ColumnDefinitions="*,*,*,*,*"
              Padding="0"
              Margin="0"
              BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2C2C2C}"
              HeightRequest="80">
            
            <!-- Activities Button -->
            <VerticalStackLayout Grid.Column="0" 
                                Spacing="4" 
                                HorizontalOptions="Center" 
                                VerticalOptions="Center"
                                Padding="8">
                <VerticalStackLayout.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnActivitiesClicked"/>
                </VerticalStackLayout.GestureRecognizers>
                <Border WidthRequest="44"
                        HeightRequest="44"
                        StrokeThickness="0"
                        BackgroundColor="{StaticResource Primary}">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="22"/>
                    </Border.StrokeShape>
                    <Label Text="ðŸŽ¯" 
                           FontSize="24"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>
                </Border>
                <Label Text="Activities" 
                       FontSize="11"
                       HorizontalOptions="Center"
                       HorizontalTextAlignment="Center"/>
            </VerticalStackLayout>
            
            <!-- Character Button -->
            <VerticalStackLayout Grid.Column="1" 
                                Spacing="4" 
                                HorizontalOptions="Center" 
                                VerticalOptions="Center"
                                Padding="8">
                <VerticalStackLayout.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnCharacterClicked"/>
                </VerticalStackLayout.GestureRecognizers>
                <Border WidthRequest="44"
                        HeightRequest="44"
                        StrokeThickness="0"
                        BackgroundColor="{StaticResource Primary}">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="22"/>
                    </Border.StrokeShape>
                    <Label Text="ðŸ‘¤" 
                           FontSize="24"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>
                </Border>
                <Label Text="Character" 
                       FontSize="11"
                       HorizontalOptions="Center"
                       HorizontalTextAlignment="Center"/>
            </VerticalStackLayout>
            
            <!-- Continue Button - Larger, centered -->
            <VerticalStackLayout Grid.Column="2" 
                                Spacing="4" 
                                HorizontalOptions="Center" 
                                VerticalOptions="Center"
                                Padding="8">
                <VerticalStackLayout.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnForwardGameClicked"/>
                </VerticalStackLayout.GestureRecognizers>
                <Border WidthRequest="56"
                        HeightRequest="56"
                        StrokeThickness="2"
                        Stroke="{StaticResource Primary}"
                        BackgroundColor="{StaticResource Primary}">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="28"/>
                    </Border.StrokeShape>
                    <Label Text="â–¶" 
                           TextColor="White"
                           FontSize="28"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           SemanticProperties.Hint="move the week forward by one"/>
                </Border>
            </VerticalStackLayout>
            
            <!-- Inventory Button -->
            <VerticalStackLayout Grid.Column="3" 
                                Spacing="4" 
                                HorizontalOptions="Center" 
                                VerticalOptions="Center"
                                Padding="8">
                <VerticalStackLayout.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnInventoryClicked"/>
                </VerticalStackLayout.GestureRecognizers>
                <Border WidthRequest="44"
                        HeightRequest="44"
                        StrokeThickness="0"
                        BackgroundColor="{StaticResource Primary}">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="22"/>
                    </Border.StrokeShape>
                    <Label Text="ðŸŽ’" 
                           FontSize="24"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>
                </Border>
                <Label Text="Inventory" 
                       FontSize="11"
                       HorizontalOptions="Center"
                       HorizontalTextAlignment="Center"/>
            </VerticalStackLayout>
            
            <!-- Jobs/Quests Button -->
            <VerticalStackLayout Grid.Column="4" 
                                Spacing="4" 
                                HorizontalOptions="Center" 
                                VerticalOptions="Center"
                                Padding="8">
                <VerticalStackLayout.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnJobsClicked"/>
                </VerticalStackLayout.GestureRecognizers>
                <Border WidthRequest="44"
                        HeightRequest="44"
                        StrokeThickness="0"
                        BackgroundColor="{StaticResource Primary}">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="22"/>
                    </Border.StrokeShape>
                    <Label Text="ðŸ“‹" 
                           FontSize="24"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>
                </Border>
                <Label Text="Jobs" 
                       FontSize="11"
                       HorizontalOptions="Center"
                       HorizontalTextAlignment="Center"/>
            </VerticalStackLayout>
            
        </Grid>
    </Grid>
</ContentPage>